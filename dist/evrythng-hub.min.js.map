{"version":3,"sources":["evrythng-hub.js"],"names":["root","factory","define","amd","load","moduleName","parentRequire","onload","onLoadSuccess","moduleInstance","onLoadFailure","err","failedId","requireModules","requirejs","undef","WS","JWT","Jose","undefined","exports","MQTT","tryLoading","name","module","require","e","EVT","Hub","Evrythng","KJUR","nodeJose","this","_isObject","obj","Object","prototype","toString","call","generateId","util","base64url","encode","randomBytes","initSecretKey","key","JWK","asKey","encrypt","input","options","JSON","stringify","JWE","createEncrypt","update","final","decrypt","createDecrypt","then","result","plaintext","createJWT","kid","header","alg","typ","claims","iss","aud","sub","jti","data","jws","JWS","sign","verifyJWT","validateOptions","decodeJWT","split","parse","decode","payload","encryptHeader","secretKey","format","encryptPayload","jwt","decryptPayload","isValid","Error","version","defaultSettings","httpApiUrl","mqttApiUrl","wsApiUrl","timeout","remote","secure","hubId","localEndpoints","path","method","EVTHubPlugin","settings","setup","customSettings","validateSettings","console","warn","apiUrl","TypeError","i","hasOwnProperty","install","Resource","localApi","args","arguments","interceptors","request","getUrl","getThng","getSecretKey","buildEncrypted","concat","original","api","apply","catch","pubSubPlugin","cancelled","localPubSub","$this","cachedApiKey","apiKey","remoteApiUrl","localApiUrl","$resource","cachedCallback","isEncryptedKey","scope","encryptedKeyMap","cancel","headers","authorization","secureCallback","url","isRemote","supportedByHub","isSecure","hubThng","thng","hasSecretKey","customFields","promises","cachedOptions","push","Promise","resolve","getEncryptedKey","all","encrypted","response","res","buildDecrypted","decrypted","indexOf","secret","encryptedKeyPromiseMap","encryptedKeyPromise","exec","length","test","entity","cb","msg","resource","subscribe","publish","utils","$inject"],"mappings":"CA+BC,SAAUA,EAAMC,GACf,YAEA,IAAsB,kBAAXC,SAAyBA,OAAOC,IAMzCD,OAAO,eACLE,KAAM,SAAUC,EAAYC,EAAeC,GAEzC,GAAIC,GAAgB,SAAUC,GAC5BF,EAAOE,IAGLC,EAAgB,SAAUC,GAC5B,GAAIC,GAAWD,EAAIE,gBAAkBF,EAAIE,eAAe,EAGxDC,WAAUC,MAAMH,GAChBV,OAAOU,KAAc,cAErBN,GAAeM,GAAWJ,GAG5BF,IAAeD,GAAaG,EAAeE,MAM/CR,QACE,uBACA,qBACA,mCACC,SAAUc,EAAIC,EAAKC,GACpB,MAAOjB,GAAQkB,OAAWH,EAAIC,EAAKC,SAGhC,IAAuB,gBAAZE,SAAsB,CAKtC,GAAIC,GAAMJ,EAAKC,EAAMI,CAErBA,GAAa,SAAUC,GACrB,GAAIC,EAEJ,KACEA,EAASC,QAAQF,GACjB,MAAOG,IAEP,QACA,MAAOF,KAIXH,EAAOC,EAAW,iBAClBL,EAAMK,EAAW,aACjBJ,EAAOI,EAAW,aAElBE,OAAOJ,QAAUnB,EAAQoB,EAAMF,OAAWF,EAAKC,OAK/ClB,GAAK2B,IAAIC,IAAM5B,EAAK6B,SAASD,IAAM3B,EAAQkB,OAAWnB,EAAK2B,IAAIX,GAAIhB,EAAK8B,KAAM9B,EAAK+B,WAIrFC,KAAM,SAAUX,EAAML,EAAIC,EAAKC,GAC/B,YAgFA,SAASe,GAAUC,GACjB,MAA+C,oBAAxCC,OAAOC,UAAUC,SAASC,KAAKJ,GAQxC,QAASK,KACP,MAAOrB,GAAKsB,KAAKC,UAAUC,OAAOxB,EAAKsB,KAAKG,YAAY,KAS1D,QAASC,GAAcC,GACrB,MAAO3B,GAAK4B,IAAIC,MAAMF,GAQxB,QAASG,GAAQC,EAAOJ,EAAKK,GAO3B,MANAA,GAAUA,MAENjB,EAAUgB,KACZA,EAAQE,KAAKC,UAAUH,IAGlB/B,EAAKmC,IACTC,cAAcJ,EAASL,GACvBU,OAAON,GACPO,QASL,QAASC,GAAQR,EAAOJ,GACtB,MAAO3B,GAAKmC,IACTK,cAAcb,GACdY,QAAQR,GACRU,KAAK,SAAUC,GACd,MAAOA,GAAOC,UAAUxB,aAW9B,QAASyB,GAAUZ,EAASa,GAC1B,GAAIC,IAAUC,IAAK,QAASC,IAAK,OAE7BC,GACFC,IAAKlB,EAAQkB,IACbC,IAAKnB,EAAQmB,IACbC,IAAKpB,EAAQoB,IACbC,IAAKrB,EAAQqB,KAAOhC,IACpBiC,KAAMtB,EAAQsB,KAGhB,OAAOvD,GAAIwD,IAAIC,IACZC,KAAK,QAASxB,KAAKC,UAAUY,GAASb,KAAKC,UAAUe,GAASJ,GASnE,QAASa,GAAU3B,EAAOc,EAAKc,GAI7B,MAHAA,GAAkBA,MAClBA,EAAgBZ,KAAO,SAEhBhD,EAAIwD,IAAIC,IAAIE,UAAU3B,EAAOc,EAAKc,GAQ3C,QAASC,GAAU7B,GAGjB,MAFAA,GAAQA,EAAM8B,MAAM,MAGlBf,OAAQb,KAAK6B,MAAMC,EAAOhC,EAAM,KAChCiC,QAAS/B,KAAK6B,MAAMC,EAAOhC,EAAM,MASrC,QAASkC,GAAcnB,EAAQoB,GAC7B,MAAOpC,GAAQgB,EAAQoB,GAAaC,OAAQ,YAS9C,QAASC,GAAeJ,EAASE,EAAWlC,GAC1C,GAAIqC,GAAMzB,GACRM,IAAKlB,EAAQkB,IACbC,IAAKnB,EAAQmB,IACbC,IAAKpB,EAAQoB,IACbE,KAAMU,GACLE,EAAUrB,IAEb,OAAOf,GAAQuC,EAAKH,GAUtB,QAASI,GAAeN,EAASE,EAAWlC,GAC1C,MAAOO,GAAQyB,EAASE,GAAWzB,KAAK,SAAU4B,GAChD,GAAIE,GAAUb,EAAUW,EAAKH,EAAUrB,KACrCK,KAAMlB,EAAQkB,KACdC,KAAMnB,EAAQmB,KACdC,KAAMpB,EAAQoB,MAGhB,IAAImB,EACF,MAAOX,GAAUS,GAAKL,QAAQV,IAE9B,MAAM,IAAIkB,OAAM,mCAMtB,QAAST,GAAOhC,GACd,MAAO/B,GAAKsB,KAAKC,UAAUwC,OAAOhC,EAAO,QA1O3C,GAAI0C,GAAU,QAYVC,GACFC,WAAY,wBACZC,WAAY,6BACZC,SAAU,2BACVC,QAAS,IACTC,QAAQ,EACRC,QAAQ,EACRC,MAAO,MAOLC,IAGAC,KAAM,YACNC,QAAS,SAGTD,KAAM,oBACNC,QAAS,SAGTD,KAAM,gCACNC,QAAS,OAAQ,MAAO,SAGxBD,KAAM,wCACNC,QAAS,MAAO,SAGhBD,KAAM,qCACNC,QAAS,OAAQ,SAGjBD,KAAM,6CACNC,QAAS,SAGTD,KAAM,kBACNC,QAAS,SAGTD,KAAM,0BACNC,QAAS,SAGTD,KAAM,iCACNC,QAAS,SAGTD,KAAM,2CACNC,QAAS,OAAQ,SAGjBD,KAAM,mDACNC,QAAS,SAGTD,KAAM,cACNC,QAAS,SAqKTC,GAEFZ,QAASA,EAETa,SAAUZ,EAGVa,MAAO,SAAUC,GAEf,QAASC,GAAiBH,GAuBxB,MAnBIA,GAASN,SAAWM,EAASL,OAE/BS,QAAQC,KAAK,mEACbL,EAASN,QAAS,IAETM,EAASN,SAAUM,EAASL,OAAWlF,GAAOC,IAEvD0F,QAAQC,KAAK,6FACbL,EAASN,QAAS,GAKhBM,EAASM,SACXF,QAAQC,KAAK,+EACbL,EAASX,WAAaW,EAASM,aACxBN,GAASM,QAGXN,EAGT,IAAIvE,EAAUyE,GAUZ,KAAM,IAAIK,WAAU,iDAPpB,KAAK,GAAIC,KAAKN,GACRA,EAAeO,eAAeD,KAChChF,KAAKwE,SAASQ,GAAKN,EAAeM,GAQxC,OAAOL,GAAiB3E,KAAKwE,WAG/BU,QAAS,SAAUvF,EAAKwF,GAgBtB,QAASC,GAASlE,GAChB,GAAImE,GAAOC,UAEPC,IACFC,QAASC,IAETD,QAASE,IAETF,QAASG,IAETH,QAASI,GAKX,OAFA1E,GAAQqE,aAAeA,EAAaM,OAAO3E,EAAQqE,kBAAoBM,OAAOlG,EAAI6E,SAASe,kBAEpFO,EAASC,IAAIC,MAAMrG,EAAK0F,GAC5BY,MAAM,SAAUtH,GAIf,KAAIuH,GAAgBvH,GAAOA,EAAIwH,WAS/B,aAJOjF,GAAQ4D,aACR5D,GAAQ8C,QACf9C,EAAQqE,gBAEDO,EAASC,IAAIC,MAAMrG,EAAK0F,KAIrC,QAASe,GAAY9B,GACnB,MAAO,YACL,GAAI+B,EAAM7B,SAASP,OACjB,MAAO6B,GAASxB,GAAQ0B,MAAMhG,KAAMsF,UAGtC,IAKEgB,GACAC,EANEC,EAAeN,EAAa1B,SAASM,OACvC2B,EAAcP,IAAiB7G,EAAOgH,EAAM7B,SAASV,WAAauC,EAAM7B,SAAST,SACjF2C,EAAY1G,KACZqF,EAAOC,UACPqB,EAAiBtB,EAAK,EAIxBiB,GAAeM,EAAeF,EAAUG,MAAMN,QAC5CO,EAAgBJ,EAAUG,MAAMN,QAAUG,EAAUG,MAAMN,MAE5D,IAAIhB,KACFC,QAASE,IAETF,QAASG,IAETH,QAASI,IAETJ,QAAS,SAAUtE,EAAS6F,GAC1BR,EAASrF,EAAQ8F,QAAQC,cACzBF,MAMJ,OAAOjB,GAASC,KACdkB,cAAeP,EAAUG,MAAMN,OAC/BtC,QAAQ,EACRC,OAAQmC,EAAM7B,SAASN,OACvBqB,aAAcA,IACbU,MAAM,WAgBP,MAdAS,GAAUG,MAAMN,OAASA,EAEzBL,EAAazB,OACXK,OAAQ2B,IAINJ,EAAM7B,SAASN,QAAqB,cAAXI,IAC3Be,EAAK,GAAK6B,EAAe7B,EAAK,IAC5B8B,IAAKT,EAAUrC,KACf4C,cAAeX,KAIZR,EAASxB,GAAQ0B,MAAMU,EAAWrB,GACtCY,MAAM,SAAUtH,GAef,MAZAuH,GAAazB,OACXK,OAAQ0B,IAINH,EAAM7B,SAASN,QAAqB,cAAXI,IAC3Be,EAAK,GAAKsB,GAIZD,EAAUG,MAAMN,OAASD,EAElBR,EAASxB,GAAQ0B,MAAMU,EAAWrB,QAenD,QAASI,GAAOvE,GACd,MAAIkG,GAASlG,GACJA,GACEmG,EAAenG,KAGxBA,EAAQ4D,OAASuB,EAAM7B,SAASX,WAChC3C,EAAQ8C,QAAUqC,EAAM7B,SAASR,SAE5B9C,GAGT,QAASwE,GAAQxE,GACf,OAAKoG,EAASpG,IAAYkG,EAASlG,GAC1BA,GAGJqG,IACHA,EAAUzB,EAASC,KACjBoB,IAAK,UAAYd,EAAM7B,SAASL,MAChCoB,gBACA0B,cAAe/F,EAAQ+F,iBAIpB/F,GAGT,QAASyE,GAAazE,GACpB,MAAKqG,GAIEA,EAAQ5F,KAAK,SAAU6F,GAK5B,MAJIC,GAAaD,KACfpE,EAAYxC,EAAc4G,EAAKE,aAAa7G,MAGvCK,IARAA,EAYX,QAAS0E,GAAe1E,GACtB,MAAKkC,GAIEA,EAAUzB,KAAK,SAAUd,GAC9B,GAAI8G,MACFC,IAsBF,OApBIhB,GAAe1F,EAAQ+F,gBACzBU,EAASE,KAAKC,QAAQC,QAAQ7G,EAAQ+F,gBACtC/F,EAAQ+F,cAAgBH,EAAgB5F,EAAQ+F,gBAEhDU,EAASE,KAAKG,EAAgB9G,EAAQ+F,cAAepG,IAKvD+G,EAAcX,cAAgB/F,EAAQ+F,cACtCW,EAAcT,IAAMjG,EAAQiG,IAExBjG,EAAQsB,MACVmF,EAASE,KAAKvE,EAAepC,EAAQsB,KAAM3B,GACzCuB,IAAKlB,EAAQ+F,cACb5E,IAAKgE,EAAM7B,SAASL,MACpB7B,IAAKpB,EAAQiG,OAIVW,QAAQG,IAAIN,GAAUhG,KAAK,SAAUuG,GAiB1C,MAhBAhH,GAAQ8F,QAAQC,cAAgBiB,EAAU,GAErCpB,EAAgB5F,EAAQ+F,iBAC3BH,EAAgBoB,EAAU,IAAMhH,EAAQ+F,eAGtC/F,EAAQsB,OACVtB,EAAQsB,KAAO0F,EAAU,IAG3BhH,EAAQqE,eACN4C,SAAU,SAASC,GACjB,MAAOC,GAAeD,EAAKR,MAIxB1G,MA5CFA,EAiDX,QAASmH,GAAeD,EAAKlH,GAC3B,GAAIkH,EACF,MAAOhF,GAAUzB,KAAK,SAAUd,GAC9B,MAAO2C,GAAe4E,EAAKvH,GACzBwB,IAAKnB,EAAQ+F,cACb7E,IAAKiE,EAAM7B,SAASL,MACpB7B,IAAKpB,EAAQiG,MACZxF,KAAK,SAAU2G,GAChB,MAAOA,OAMf,QAASlB,GAASlG,GAChB,MAA0B/B,UAAnB+B,EAAQ+C,OAAuB/C,EAAQ+C,OAASoC,EAAM7B,SAASP,OAGxE,QAASqD,GAASpG,GAChB,MAA0B/B,UAAnB+B,EAAQgD,OAAuBhD,EAAQgD,OAASmC,EAAM7B,SAASN,OAGxE,QAAS0C,GAAe/F,GACtB,MAAOA,GAAI0H,QAAQ,MAAO,EAG5B,QAASP,GAAgBzB,EAAQiC,GAC/B,GAAIC,EAAuBlC,GACzB,MAAOkC,GAAuBlC,EAGhC,IAAImC,GAAsBvF,EAAcoD,EAAQiC,EAIhD,OAFAC,GAAuBlC,GAAUmC,EAE1BA,EAGT,QAASrB,GAAenG,GAQtB,IAAK,GALDmD,GAAO,eAAesE,KAAKzH,EAAQiG,KAAK,GAC1C7C,EAASpD,EAAQoD,QAAU,MAIpBU,EAAI,EAAGA,EAAIZ,EAAewE,UAC7BxE,EAAeY,GAAGX,KAAKwE,KAAKxE,IAASD,EAAeY,GAAGV,OAAOiE,QAAQjE,MAAY,GAD7CU,KAM3C,MAAQA,GAAIZ,EAAewE,OAG7B,QAASnB,GAAaqB,GACpB,MAAOA,IAAUA,EAAOpB,cAAgBzH,EAAU6I,EAAOpB,aAAa7G,KAGxE,QAASqG,GAAe6B,EAAI7H,GAC1B,MAAO,UAAU8H,GACf,GAAIC,GAAWD,EAAIC,QAEnB,OAAO7F,GAAUzB,KAAK,SAAUd,GAC9B,MAAO2C,GAAewF,EAAKnI,GACzBwB,IAAKnB,EAAQ+F,cACb7E,IAAKiE,EAAM7B,SAASL,MACpB7B,IAAKpB,EAAQiG,MACZxF,KAAK,SAAU2G,GAChB,MAAOS,GAAGE,EAASjG,MAAMsF,SAtSjC,GAAIjC,GAAQrG,KACVkG,EAAe7G,GAAQL,EAEvBuI,EAAU,KACVnE,EAAY,KAEZ0D,KACA2B,KAEE3C,GACFC,IAAKpG,EAAIoG,IACTmD,UAAW/D,EAAS/E,UAAU8I,UAC9BC,QAAShE,EAAS/E,UAAU+I,QA+G9BxJ,GAAIoG,IAAMX,EAINc,IACFf,EAAS/E,UAAU8I,UAAY9C,EAAY,aAC3CjB,EAAS/E,UAAU+I,QAAU/C,EAAY,aAiM/C,OAlBInH,IAAOC,IACTqF,EAAa6E,OACX7I,WAAYA,EACZK,cAAeA,EACfI,QAASA,EACTS,QAASA,EACTK,UAAWA,EACXc,UAAWA,EACXE,UAAWA,EACXK,cAAeA,EACfG,eAAgBA,EAChBE,eAAgBA,IAKpBe,EAAa8E,SAAW,OAAQ,YAEzB9E","file":"evrythng-hub.min.js"}